<script src="https://www.desmos.com/api/v1.3/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6"></script>
<html lang='en'>
   <head>
      <title>Desmos | Graphing Calculator</title>
      <link rel='icon' href='calc_thumb.png'>
   </head>
   <div id="calculator" style="width: 100%; height: 100%;"></div>
   <script>
       var elt = document.getElementById('calculator');
       var calculator = Desmos.GraphingCalculator(elt);
       calculator.setExpression({ id: 'top', latex: 'y=0 \\{0<x<480\\}', color: '#2464b4', label: 'y=0', showLabel: true });
       calculator.setExpression({ id: 'bottom', latex: 'y=360 \\{0<x<480\\}', color: '#2464b4', label: 'y=360', showLabel: true });
       calculator.setExpression({ id: 'left', latex: 'x=0 \\{0<y<360\\}', color: '#2464b4', label: 'x=0', showLabel: true });
       calculator.setExpression({ id: 'right', latex: 'x=480 \\{0<y<360\\}', color: '#2464b4', label: 'x=480', showLabel: true });
       calculator.setExpression({ id: 'frame', latex: 'frame=0' });
       var labelLimit = 10;

       function colorForIndex(i) {
           var hue = (i * 47) % 360;
           return 'hsl(' + hue + ', 70%, 45%)';
       }
   
       function changeGraph(key, latex, frame) {
           calculator.removeExpression({ id: 'frame' });
           calculator.setExpression({ id: 'frame', latex: `frame=${frame}` });

           while (key > 0) {
               calculator.removeExpression({ id: 'expr-' + key });
               key--;
           }
           for (var expr of latex) {
               console.log(expr);
               key++;
               var exprObj = { id: 'expr-' + key, latex: expr, color: colorForIndex(key) };
               if (key <= labelLimit) {
                   exprObj.label = 'â–  ' + expr;
                   exprObj.showLabel = true;
               }
               calculator.setExpression(exprObj);
           }
           return key;
       }
   
       var playTimer = null;

       function go() {
           var key = 0;
           var frame = 0;

           if (playTimer) {
               clearInterval(playTimer);
           }
           playTimer = setInterval(function() {
               if (frame < latexFrames.length) {
                   key = changeGraph(key, latexFrames[frame], frame);
                   frame++;
               }
           }, 1000/24)
       }

       function play() {
           if (typeof latexFrames === 'undefined') {
               init();
               return;
           }
           go();
       }

       function pause() {
           if (playTimer) {
               clearInterval(playTimer);
               playTimer = null;
           }
       }

       function showFrame(n) {
           if (typeof latexFrames === 'undefined') {
               init();
               return;
           }
           if (playTimer) {
               clearInterval(playTimer);
               playTimer = null;
           }
           if (n < 0 || n >= latexFrames.length) {
               return;
           }
           changeGraph(0, latexFrames[n], n);
       }

       function test() {
           xhr = new XMLHttpRequest();
           xhr.open("GET", "http://127.0.0.1:5000/");
           xhr.send();
   
           xhr.onload = function() {
               latexFrames = JSON.parse(xhr.response);
                changeGraph(0, latexFrames[100], 100);
           }
       }
   
       function init() {
           xhr = new XMLHttpRequest();
           xhr.open("GET", "http://127.0.0.1:5000/");
           xhr.send();
   
           xhr.onload = function() {
               latexFrames = JSON.parse(xhr.response);
               go();
           }
       }
   
   </script>
</html>
